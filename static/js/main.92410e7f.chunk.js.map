{"version":3,"sources":["index.js"],"names":["get","url","a","fetch","method","res","json","post","body","headers","JSON","stringify","joinGame","game","getGame","player","takeTurn","move","placements","Piece","props","style","value","other","width","height","lineHeight","display","cursor","backgroundColor","verticalAlign","textAlign","margin","ReactDOM","render","rel","href","integrity","crossorigin","path","component","useState","setPlayer","setGame","Array","fill","setPlacements","dragged","setDragged","scrollView","useRef","params","useParams","isOurTurn","nextPlayer","order","useEffect","id","callback","delay","savedCallback","current","setInterval","clearInterval","useInterval","scrollTo","left","scrollLeftMax","top","scrollTopMax","behavior","rack","split","board","e","A","i","length","push","nextMove","join","styles","StyleSheet","create","flexFlow","overflow","scrollbarWidth","flexGrow","flexShrink","scrollSnapAlign","row","whiteSpace","n","Math","sqrt","color","pending","floor","k","pop","includes","placeable","Board","className","css","map","_","j","draggable","onDrag","preventDefault","indexOf","onDragOver","opacity","onDrop","ref","el","disabled","onClick","history","useHistory","submit","size","maxPlayers","fluid","onSubmit","Group","Label","Control","as","variant","type","document","getElementById"],"mappings":"8PAYMA,EAAG,uCAAG,WAAOC,GAAP,eAAAC,EAAA,sEACQC,MAAMF,EAAK,CAAEG,OAAO,QAD5B,cACJC,EADI,gBAEKA,EAAIC,OAFT,mFAAH,sDAIHC,EAAI,uCAAG,WAAON,EAAKO,GAAZ,eAAAN,EAAA,sEACOC,MAAMF,EAAK,CACvBG,OAAO,OACPK,QAAS,CAAC,eAAgB,oBAC1BD,KAAMA,EAAME,KAAKC,UAAUH,GAAQ,KAJ9B,cACLH,EADK,gBAMIA,EAAIC,OANR,mFAAH,wDAQJM,EAAW,SAACC,GAAD,OAAUN,EAAK,sCAAD,OAAuCM,KAChEC,EAAU,SAACD,EAAME,GAAP,OAAkBf,EAAI,+BAAD,OAAgCa,EAAhC,mBAA+CE,KAC9EC,EAAW,SAACC,EAAMJ,EAAME,EAAQG,GAArB,OAAoCX,EAAK,+BAAD,OAAgCU,EAAhC,iBAA6CJ,EAA7C,mBAA4DE,GAAU,CAAEG,WAAWA,KAyB5I,SAASC,EAAMC,GAAQ,IACXC,EAA2BD,EAA3BC,MAAOC,EAAoBF,EAApBE,MAAUC,EADP,YACiBH,EADjB,mBAElB,OACI,+CAASG,GAAT,IACIF,MAAK,aACDG,MAAO,OACPC,OAAQ,OACRC,WAAY,OACZC,QAAS,eACTC,OAAQ,UACRC,gBAAiB,OACjBC,cAAe,SACfC,UAAW,SACXC,OAAQ,OACLX,GAXX,SAaGC,KA4LXW,IAASC,OACL,eAAC,IAAD,WACI,sBACAC,IAAI,aACJC,KAAK,wEACLC,UAAU,0EACVC,YAAY,cAEZ,eAAC,IAAD,WACI,cAAC,IAAD,CAAOC,KAAK,eAAeC,UAtKvC,SAAcpB,GAAQ,IAAD,EACWqB,mBAAS,MADpB,mBACV1B,EADU,KACF2B,EADE,OAEOD,mBAAS,MAFhB,mBAEV5B,EAFU,KAEJ8B,EAFI,OAGmBF,mBAASG,MAAM,GAAGC,KAAK,OAH1C,mBAGV3B,EAHU,KAGE4B,EAHF,OAIaL,mBAAS,MAJtB,mBAIVM,EAJU,KAIDC,EAJC,KAKXC,EAAaC,iBAAO,MACpBC,EAASC,cACTC,EAAYxC,GAAQE,GAAUF,EAAKyC,aAAevC,EAAOwC,MAsB/D,GApBAC,qBAAU,WACN,sBAAC,sBAAAtD,EAAA,yDACQa,EADR,4BAEO2B,EAFP,SAEuB9B,EAASuC,EAAOtC,MAFvC,4DAGaA,EAHb,6BAIO8B,EAJP,UAIqB7B,EAAQqC,EAAOtC,KAAME,EAAO0C,IAJjD,8EAAD,KAMD,CAAC1C,EAAQF,EAAMsC,IAnFtB,SAAqBO,EAAUC,GAC3B,IAAMC,EAAgBV,mBAGtBM,qBAAU,WACNI,EAAcC,QAAUH,IACzB,CAACA,IAGJF,qBAAU,WAIN,GAAc,OAAVG,EAAgB,CAChB,IAAIF,EAAKK,aAJb,WACIF,EAAcC,YAGaF,GAC3B,OAAO,kBAAMI,cAAcN,OAEhC,CAACE,IAoEJK,EAAY,WACR,sBAAC,sBAAA9D,EAAA,kEACGyC,EADH,SACiB7B,EAAQqC,EAAOtC,KAAME,EAAO0C,IAD7C,kCAEGR,EAAWY,QAAQI,SAAS,CACxBC,KAAMjB,EAAWY,QAAQM,cAAc,EACvCC,IAAKnB,EAAWY,QAAQQ,aAAa,EACrCC,SAAU,WALjB,0CAAD,KAQDjB,EAAW,KAAO,MAEhBxC,IAASE,EACV,OAAO,6CAEX,IAAMwD,EAAOxD,EAAOwD,KAAKC,MAAM,KACzBC,EAAQ5D,EAAK4D,MAAMD,MAAM,KAjCd,4CAmCjB,WAAsBE,GAAtB,mBAAAxE,EAAA,sDAEI,IADMyE,EAAI,GACDC,EAAI,EAAGA,EAAI1D,EAAW2D,OAAQD,IACb,OAAlB1D,EAAW0D,KACXD,EAAEG,KAAK5D,EAAW0D,IAClBD,EAAEG,KAAKP,EAAKK,KALxB,gBAOsB5D,EAASH,EAAKkE,SAAU5B,EAAOtC,KAAME,EAAO0C,GAAIkB,EAAEK,KAAK,MAP7E,OAOU3E,EAPV,OAQIyC,EAAcF,MAAM,GAAGC,KAAK,OAC5BH,EAAU,2BAAI3B,GAAUV,EAAIU,SAC5B4B,EAAQ,2BAAI9B,GAAQR,EAAIQ,OAExBoC,EAAWY,QAAQI,SAAS,CACxBC,KAAMjB,EAAWY,QAAQM,cAAc,EACvCC,IAAKnB,EAAWY,QAAQQ,aAAa,EACrCC,SAAU,WAflB,4CAnCiB,sBAsDjB,IAAMW,EAASC,IAAWC,OAAO,CAC7BtE,KAAM,CACFc,QAAS,OACTyD,SAAU,SACV3D,OAAQ,SAEZgD,MAAO,CACHY,SAAU,SACVC,eAAgB,OAChBC,SAAU,IACVC,WAAY,IACZC,gBAAiB,UAErBC,IAAK,CACDC,WAAY,YAIdC,EAAIC,KAAKC,KAAKrB,EAAMI,QACpBkB,EApGV,SAAmBtB,EAAOvD,GACtB,IAAM0E,EAAIC,KAAKC,KAAKrB,EAAMI,QACpBkB,EAAQnD,MAAM6B,EAAMI,QAAQhC,KAAK,GACjCmD,EAAU,GAGhB,IADAA,EAAQlB,KAAKe,KAAKI,MAAMxB,EAAMI,OAAO,IAC9BmB,EAAQnB,OAAS,GAAG,CACvB,IAAMqB,EAAIF,EAAQG,MACF,MAAZ1B,EAAMyB,IAAchF,EAAWkF,SAASF,IAKxCH,EAAMG,GAAK,EAEXA,EAAE,GAAK,IAAMH,EAAMG,EAAE,IACrBF,EAAQlB,KAAKoB,EAAE,GACfA,EAAE,EAAIzB,EAAMI,SAAWkB,EAAMG,EAAE,IAC/BF,EAAQlB,KAAKoB,EAAE,GACfA,EAAEN,GAAK,IAAMG,EAAMG,EAAEN,IACrBI,EAAQlB,KAAKoB,EAAEN,GACfM,EAAEN,EAAInB,EAAMI,SAAWkB,EAAMG,EAAEN,IAC/BI,EAAQlB,KAAKoB,EAAEN,IAbfG,EAAMG,GAAK,EAenB,OAAOH,EA4EOM,CAAU5B,EAAOvD,GACzBoF,EAAQ,SAAClF,GAAD,OACV,qBAAKmF,UAAWC,YAAIvB,EAAOR,OAA3B,SACC7B,MAAMgD,GAAG/C,KAAK,GAAG4D,KAAI,SAACC,EAAGC,GAAJ,OACtB,qBAAKJ,UAAWC,YAAIvB,EAAOS,KAA3B,SACK9C,MAAMgD,GAAG/C,KAAK,GAAG4D,KAAI,SAACC,EAAG9B,GAAJ,OACtB1D,EAAWkF,SAASO,EAAEf,EAAEhB,GACpB,cAACzD,EAAD,CAEIyF,UAAWvD,EACXwD,OAAQ,SAAAnC,GAAOA,EAAEoC,iBAAkB9D,EAAW9B,EAAW6F,QAAQJ,EAAEf,EAAEhB,KACrEoC,WAAY,SAAAtC,GAAC,OAAIA,EAAEoC,kBACnBxF,MAAOiD,EAAKrD,EAAW6F,QAAQJ,EAAEf,EAAEhB,KAJ9B+B,EAAEf,EAAEhB,GAMb,cAACzD,EAAD,CACIE,MAAO,CAAE4F,QAA2B,IAAjBlB,EAAMY,EAAEf,EAAEhB,GAAW,EAAM,IAE9CgC,WAAW,EACXI,WAAY,SAAAtC,GAAC,OAAIA,EAAEoC,kBACnBI,OAAQ,SAAAxC,GAAOxD,EAAW6B,GAAW4D,EAAEf,EAAEhB,EAAG9B,EAAc5B,GAAa8B,EAAW,OAClF1B,MAAOmD,EAAMkC,EAAEf,EAAEhB,IAJZ+B,EAAEf,EAAEhB,cAYzB,OACI,sBAAK2B,UAAWC,YAAIvB,EAAOpE,MAA3B,UACI,cAACyF,EAAD,CAAO7B,MAAOA,EAAOvD,WAAYA,EAAYiG,IAAKlE,EAAYI,UAAWA,IACzE,sBAAKkD,UAAWC,YAAIvB,EAAOS,KAA3B,UACKnB,EAAKkC,KAAI,SAACW,EAAIxC,GAAL,OACN,cAACzD,EAAD,CAEIyF,UAAWvD,EACXwD,OAAQ,SAAAnC,GAAOA,EAAEoC,iBAAkB9D,EAAW4B,IAC9CoC,WAAY,SAAAtC,GAAC,OAAIA,EAAEoC,kBACnBI,OAAQ,SAAAxC,GAAOxD,EAAW6B,GAAW,KAAMD,EAAc5B,GAAa8B,EAAW,OACjF1B,MAAyB,OAAlBJ,EAAW0D,GAAawC,EAAK,KAL/BxC,MAQjB,cAAC,IAAD,CAAQyC,UAAWhE,EAAWiE,QAnHrB,4CAmHT,+BAoDA,cAAC,IAAD,CAAO/E,KAAK,IAAIC,UA9C5B,WACI,IAAM+E,EAAUC,cACVC,EAAM,uCAAG,WAAO/C,GAAP,eAAAxE,EAAA,6DACXwE,EAAEoC,iBADS,SAlMMvG,EAAK,8BAA+B,CAAEmH,KAAK,GAAIC,WAAW,IAkMhE,OAEL9G,EAFK,OAGX0G,EAAQzC,KAAR,iBAAuBjE,EAAK4C,KAHjB,2CAAH,sDAKZ,OACI,cAAC,IAAD,CAAWmE,OAAK,EAAhB,SACA,cAAC,IAAD,UAAK,cAAC,IAAD,UACL,eAAC,IAAD,CAAMC,SAAUJ,EAAhB,UACA,eAAC,IAAKK,MAAN,WACA,cAAC,IAAKC,MAAN,gCACA,eAAC,IAAKC,QAAN,CAAcC,GAAG,SAAjB,UACI,uCACA,uCACA,6CAGJ,eAAC,IAAKH,MAAN,WACA,cAAC,IAAKC,MAAN,yBACA,eAAC,IAAKC,QAAN,CAAcC,GAAG,SAAjB,UACI,wCACA,wCACA,8CAGJ,cAAC,IAAD,CAAQC,QAAQ,UAAUC,KAAK,SAA/B,wCAsBJC,SAASC,eAAe,W","file":"static/js/main.92410e7f.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport { BrowserRouter as Router, Route,\r\n    Switch, useParams, useHistory } from 'react-router-dom'\r\nimport Container from 'react-bootstrap/Container'\r\nimport Col from 'react-bootstrap/Col'\r\nimport Row from 'react-bootstrap/Row'\r\nimport Button from 'react-bootstrap/Button'\r\nimport Form from 'react-bootstrap/Form'\r\nimport { StyleSheet, css } from 'aphrodite'\r\n\r\n\r\nconst get = async (url) => {\r\n    let res = await fetch(url, { method:'GET' });\r\n    return await res.json()\r\n}\r\nconst post = async (url, body) => {\r\n    let res = await fetch(url, {\r\n        method:'POST',\r\n        headers: {'Content-Type': 'application/json'},\r\n        body: body? JSON.stringify(body) : ''\r\n    });\r\n    return await res.json()\r\n}\r\nconst joinGame = (game) => post(`http://localhost:3000/players?game=${game}`)\r\nconst getGame = (game, player) => get(`http://localhost:3000/games/${game}?player=${player}`)\r\nconst takeTurn = (move, game, player, placements) => post(`http://localhost:3000/moves/${move}?game=${game}&player=${player}`, { placements:placements })\r\nconst createGame = () => post('http://localhost:3000/games', { size:15, maxPlayers:2 })\r\n\r\n// Taken from\r\n// https://overreacted.io/making-setinterval-declarative-with-react-hooks/\r\nfunction useInterval(callback, delay) {\r\n    const savedCallback = useRef();\r\n\r\n    // Remember the latest callback.\r\n    useEffect(() => {\r\n        savedCallback.current = callback;\r\n    }, [callback]);\r\n\r\n    // Set up the interval.\r\n    useEffect(() => {\r\n        function tick() {\r\n            savedCallback.current();\r\n        }\r\n        if (delay !== null) {\r\n            let id = setInterval(tick, delay);\r\n            return () => clearInterval(id);\r\n        }\r\n    }, [delay]);\r\n}\r\n\r\nfunction Piece(props) {\r\n    const { style, value, ...other } = props\r\n    return (\r\n        <div {...other}\r\n            style={{\r\n                width: '80px',\r\n                height: '80px',\r\n                lineHeight: '80px',\r\n                display: 'inline-block',\r\n                cursor: 'pointer',\r\n                backgroundColor: '#eee',\r\n                verticalAlign: 'middle',\r\n                textAlign: 'center',\r\n                margin: '2px',\r\n                ...style\r\n            }\r\n        }>{value}</div>\r\n    )\r\n}\r\n\r\nfunction placeable(board, placements) {\r\n    const n = Math.sqrt(board.length)\r\n    const color = Array(board.length).fill(0)\r\n    const pending = []\r\n    \r\n    pending.push(Math.floor(board.length/2))\r\n    while (pending.length > 0) {\r\n        const k = pending.pop()\r\n        if (board[k] ===' ' && !placements.includes(k)) {\r\n            color[k] = 2\r\n            continue\r\n        }\r\n        else\r\n            color[k] = 1\r\n        \r\n        if (k-1 >= 0 && !color[k-1])\r\n            pending.push(k-1)\r\n        if (k+1 < board.length && !color[k+1])\r\n            pending.push(k+1)\r\n        if (k-n >= 0 && !color[k-n])\r\n            pending.push(k-n)\r\n        if (k+n < board.length && !color[k+n])\r\n            pending.push(k+n)\r\n    }\r\n    return color\r\n}\r\n\r\nfunction Game(props) {\r\n    const [player, setPlayer] = useState(null)\r\n    const [game, setGame] = useState(null)\r\n    const [placements, setPlacements] = useState(Array(7).fill(null))\r\n    const [dragged, setDragged] = useState(null)\r\n    const scrollView = useRef(null)\r\n    const params = useParams()\r\n    const isOurTurn = game && player && game.nextPlayer === player.order\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (!player)\r\n                setPlayer(await joinGame(params.game))\r\n            else if (!game)\r\n                setGame(await getGame(params.game, player.id))\r\n        })()\r\n    }, [player, game, params])\r\n\r\n    useInterval(() => {\r\n        (async () => {\r\n            setGame(await getGame(params.game, player.id))\r\n            scrollView.current.scrollTo({\r\n                left: scrollView.current.scrollLeftMax/2,\r\n                top: scrollView.current.scrollTopMax/2,\r\n                behavior: 'smooth'\r\n            })\r\n        })()\r\n    }, isOurTurn? null : 3000)\r\n\r\n    if (!game || !player)\r\n        return <div>Loading...</div>\r\n\r\n    const rack = player.rack.split(',')\r\n    const board = game.board.split(',')\r\n\r\n    async function submit(e) {\r\n        const A = []\r\n        for (let i = 0; i < placements.length; i++)\r\n            if (placements[i] !== null) {\r\n                A.push(placements[i])\r\n                A.push(rack[i])\r\n            }\r\n        const res = await takeTurn(game.nextMove, params.game, player.id, A.join(','))\r\n        setPlacements(Array(7).fill(null))\r\n        setPlayer({...player,...res.player})\r\n        setGame({...game,...res.game})\r\n\r\n        scrollView.current.scrollTo({\r\n            left: scrollView.current.scrollLeftMax/2,\r\n            top: scrollView.current.scrollTopMax/2,\r\n            behavior: 'smooth'\r\n        })\r\n    }\r\n        \r\n    const styles = StyleSheet.create({\r\n        game: {\r\n            display: 'flex',\r\n            flexFlow: 'column',\r\n            height: '100vh'\r\n        },\r\n        board: {\r\n            overflow: 'scroll',\r\n            scrollbarWidth: 'none',\r\n            flexGrow: '1',\r\n            flexShrink: '1',\r\n            scrollSnapAlign: 'center',\r\n        },\r\n        row: {\r\n            whiteSpace: 'nowrap'\r\n        },\r\n    })\r\n\r\n    const n = Math.sqrt(board.length)\r\n    const color = placeable(board, placements)\r\n    const Board = (props) => (\r\n        <div className={css(styles.board)} >\r\n        {Array(n).fill(0).map((_, j) =>\r\n        <div className={css(styles.row)}>\r\n            {Array(n).fill(0).map((_, i) =>\r\n            placements.includes(j*n+i)\r\n            ?   <Piece\r\n                    key={j*n+i}\r\n                    draggable={isOurTurn}\r\n                    onDrag={e => { e.preventDefault(); setDragged(placements.indexOf(j*n+i)) }}\r\n                    onDragOver={e => e.preventDefault()}\r\n                    value={rack[placements.indexOf(j*n+i)]}>\r\n                </Piece>\r\n            :   <Piece\r\n                    style={{ opacity: (color[j*n+i] !== 0)? 1.0 : 0.5 }}\r\n                    key={j*n+i}\r\n                    draggable={false}\r\n                    onDragOver={e => e.preventDefault()}\r\n                    onDrop={e => { placements[dragged] = j*n+i; setPlacements(placements); setDragged(null) }}\r\n                    value={board[j*n+i]}>\r\n                </Piece>\r\n            )}\r\n        </div>\r\n        )}\r\n        </div>\r\n    )\r\n\r\n    return (\r\n        <div className={css(styles.game)}>\r\n            <Board board={board} placements={placements} ref={scrollView} isOurTurn={isOurTurn} />\r\n            <div className={css(styles.row)}>\r\n                {rack.map((el, i) => (\r\n                    <Piece\r\n                        key={i}\r\n                        draggable={isOurTurn}\r\n                        onDrag={e => { e.preventDefault(); setDragged(i) }}\r\n                        onDragOver={e => e.preventDefault()}\r\n                        onDrop={e => { placements[dragged] = null; setPlacements(placements); setDragged(null)} }\r\n                        value={placements[i] === null? el : ' ' }>\r\n                    </Piece>\r\n                ))}\r\n            <Button disabled={!isOurTurn} onClick={submit}>End Turn</Button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction NewGameForm() {\r\n    const history = useHistory()\r\n    const submit = async (e) => {\r\n        e.preventDefault()\r\n        const game = await createGame()\r\n        history.push(`/games/${game.id}`)\r\n    }\r\n    return (\r\n        <Container fluid>\r\n        <Row><Col>\r\n        <Form onSubmit={submit}>\r\n        <Form.Group>\r\n        <Form.Label>Number of Players</Form.Label>\r\n        <Form.Control as=\"select\">\r\n            <option>2</option>\r\n            <option>3</option>\r\n            <option>4</option>\r\n        </Form.Control>\r\n        </Form.Group>\r\n        <Form.Group>\r\n        <Form.Label>Board size</Form.Label>\r\n        <Form.Control as=\"select\">\r\n            <option>13</option>\r\n            <option>15</option>\r\n            <option>17</option>\r\n        </Form.Control>\r\n        </Form.Group>\r\n        <Button variant=\"primary\" type=\"submit\">\r\n            New Game\r\n        </Button>\r\n        </Form>\r\n        </Col></Row>\r\n        </Container>\r\n    )\r\n}\r\n\r\nReactDOM.render(\r\n    <Router>\r\n        <link\r\n        rel=\"stylesheet\"\r\n        href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css\"\r\n        integrity=\"sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk\"\r\n        crossorigin=\"anonymous\"\r\n        />\r\n        <Switch>\r\n            <Route path='/games/:game' component={Game} />\r\n            <Route path='/' component={NewGameForm} />\r\n        </Switch>\r\n    </Router>,\r\n    document.getElementById('root')\r\n)"],"sourceRoot":""}