(this.webpackJsonpscrapple=this.webpackJsonpscrapple||[]).push([[0],{39:function(e,t,n){"use strict";n.r(t);var r=n(17),c=n(13),a=n(38),s=n(11),o=n.n(s),l=n(15),i=n(4),u=n(0),p=n(33),j=n.n(p),b=n(6),f=n(37),h=n(35),d=n(18),O=n(36),x=n(27),m=n(12),g=n(14),v=n(16),y=function(){var e=Object(l.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"GET"});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(l.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):""});case 2:return r=e.sent,e.next=5,r.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),w="otterspace.ca",D=3e3,S=function(e){return k("https://".concat(w,":").concat(D,"/players?game=").concat(e))},P=function(e,t){return y("https://".concat(w,":").concat(D,"/games/").concat(e,"?player=").concat(t))};function A(e){var t=e.style,n=e.value,r=Object(a.a)(e,["style","value"]);return Object(i.jsx)("div",Object(c.a)(Object(c.a)({},r),{},{style:Object(c.a)({width:"80px",height:"80px",lineHeight:"80px",display:"inline-block",cursor:"pointer",backgroundColor:"#eee",verticalAlign:"middle",textAlign:"center",margin:"2px"},t),children:n}))}var N=g.a.create({game:{display:"flex",flexFlow:"column",height:"100vh"},board:{overflow:"scroll",scrollbarWidth:"none",flexGrow:"1",flexShrink:"1",scrollSnapAlign:"center"},row:{whiteSpace:"nowrap"}});j.a.render(Object(i.jsxs)(f.a,{children:[Object(i.jsx)("link",{rel:"stylesheet",href:"https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css",integrity:"sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk",crossorigin:"anonymous"}),Object(i.jsxs)(b.c,{children:[Object(i.jsx)(b.a,{path:"/scrapple/games/:game",component:function(e){var t=Object(u.useState)(null),n=Object(r.a)(t,2),a=n[0],s=n[1],p=Object(u.useState)(null),j=Object(r.a)(p,2),f=j[0],h=j[1],d=Object(u.useState)(Array(7).fill(null)),O=Object(r.a)(d,2),m=O[0],y=O[1],C=Object(u.useState)(null),M=Object(r.a)(C,2),T=M[0],E=M[1],G=Object(u.useRef)(null),I=Object(b.g)(),L=Object(v.usePromiseTracker)().promiseInProgress,F=f&&a&&f.nextPlayer===a.order;if(Object(u.useEffect)((function(){Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=8;break}return e.t0=s,e.next=4,S(I.game);case 4:e.t1=e.sent,(0,e.t0)(e.t1),e.next=14;break;case 8:if(f){e.next=14;break}return e.t2=h,e.next=12,P(I.game,a.id);case 12:e.t3=e.sent,(0,e.t2)(e.t3);case 14:case"end":return e.stop()}}),e)})))()}),[a,f]),function(e,t){var n=Object(u.useRef)();Object(u.useEffect)((function(){n.current=e}),[e]),Object(u.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=h,e.next=3,P(I.game,a.id);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))()}),F?null:3e3),!f||!a)return Object(i.jsx)("div",{children:"Loading..."});var J=a.rack.split(","),R=f.board.split(","),q=Math.sqrt(R.length),z=function(e,t){var n=Math.sqrt(e.length),r=Array(e.length).fill(0),c=[];for(c.push(Math.floor(e.length/2));c.length>0;){var a=c.pop();" "!==e[a]||t.includes(a)?(r[a]=1,a-1>=0&&!r[a-1]&&c.push(a-1),a+1<e.length&&!r[a+1]&&c.push(a+1),a-n>=0&&!r[a-n]&&c.push(a-n),a+n<e.length&&!r[a+n]&&c.push(a+n)):r[a]=2}return r}(R,m);return Object(i.jsxs)("div",{className:Object(g.b)(N.game),children:[Object(i.jsx)("div",{className:Object(g.b)(N.board),ref:G,children:Array(q).fill(0).map((function(e,t){return Object(i.jsx)("div",{className:Object(g.b)(N.row),children:Array(q).fill(0).map((function(e,n){return m.includes(t*q+n)?Object(i.jsx)(A,{draggable:F,onDrag:function(e){e.preventDefault(),E(m.indexOf(t*q+n))},onDragOver:function(e){return e.preventDefault()},value:J[m.indexOf(t*q+n)]},t*q+n):Object(i.jsx)(A,{style:{opacity:0!==z[t*q+n]?1:.5},draggable:!1,onDragOver:function(e){return e.preventDefault()},onDrop:function(e){e.preventDefault(),m[T]=t*q+n,y(m),E(null)},value:R[t*q+n]},t*q+n)}))})}))}),Object(i.jsxs)("div",{className:Object(g.b)(N.row),children:[J.map((function(e,t){return Object(i.jsx)(A,{draggable:F,onDrag:function(e){e.preventDefault(),E(t)},onDragOver:function(e){return e.preventDefault()},onDrop:function(e){m[T]=null,y(m),E(null)},value:null===m[t]?e:" "},t)})),Object(i.jsx)(x.a,{disabled:L||!F,onClick:function(e){for(var t=[],n=0;n<m.length;n++)null!==m[n]&&(t.push(m[n]),t.push(J[n]));Object(v.trackPromise)(function(e,t,n,r){return k("https://".concat(w,":").concat(D,"/moves/").concat(e,"?game=").concat(t,"&player=").concat(n),{placements:r})}(f.nextMove,I.game,a.id,t.join(",")).then((function(e){y(Array(7).fill(null)),s(Object(c.a)(Object(c.a)({},a),e.player)),h(Object(c.a)(Object(c.a)({},f),e.game)),G.current.scrollTo({left:G.current.scrollLeftMax/2,top:G.current.scrollTopMax/2,behavior:"smooth"})})))},children:"Done"})]})]})}}),Object(i.jsx)(b.a,{path:"/scrapple/",component:function(){var e=Object(b.f)(),t=Object(v.usePromiseTracker)().promiseInProgress;return Object(i.jsx)(h.a,{fluid:!0,children:Object(i.jsx)(O.a,{children:Object(i.jsx)(d.a,{children:Object(i.jsxs)(m.a,{onSubmit:function(t){t.preventDefault(),Object(v.trackPromise)(k("https://".concat(w,":").concat(D,"/games"),{size:15,maxPlayers:2}).then((function(t){e.push("/scrapple/games/".concat(t.id))})))},children:[Object(i.jsxs)(m.a.Group,{children:[Object(i.jsx)(m.a.Label,{children:"Number of Players"}),Object(i.jsxs)(m.a.Control,{as:"select",children:[Object(i.jsx)("option",{children:"2"}),Object(i.jsx)("option",{children:"3"}),Object(i.jsx)("option",{children:"4"})]})]}),Object(i.jsxs)(m.a.Group,{children:[Object(i.jsx)(m.a.Label,{children:"Board size"}),Object(i.jsxs)(m.a.Control,{as:"select",children:[Object(i.jsx)("option",{children:"13"}),Object(i.jsx)("option",{children:"15"}),Object(i.jsx)("option",{children:"17"})]})]}),Object(i.jsx)(x.a,{variant:"primary",type:"submit",disabled:t,children:"New Game"})]})})})})}})]})]}),document.getElementById("root"))}},[[39,1,2]]]);
//# sourceMappingURL=main.884ecafa.chunk.js.map