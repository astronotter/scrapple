<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>scrapple</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<script src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel" src="client.jsx"></script>
<link rel="stylesheet" href="client.css">
</style>
<h1 id="scrapple">Scrapple</h1>
<p>Scrapple is a multiplayer crossword building game (in Scrabble vein) with a simple twist: the letters are Hirigana. I have always had a fascination for Japanese culture, and to this end I hope my game will be useful not only to myself but others who are interested in trying to learn the language, to provide a fun way to study with friends.</p>
<p>The rest of this article will describe the implementation details. In fact, in typical Literate Programming fashion this <em>is</em> Scrapple, or rather the ‘woven’ source code for it. If you just want to play with the final tangled result, click <a href="">here</a>.</p>
<p>There are two distinct parts to the game. The client, which can be served as a static single page application, and the server which stores the actual game state. This separation allows for multiplayer, which is after all the whole point! Only the API must be shared between them and they are otherwise completely separate. Because of this we can even choose different languages which best fit their individual goals: ECMAscript for the client and Elixir for the server.</p>
<h2 id="client">Client</h2>
<p>First let’s talk about React’s components. We’ll be using the new functional style of component, which I will briefly go over before diving in. The component is not an object like it would be in a more traditional object oriented setting, but is now a function which returns the component’s current presentation. The current state is held by React, and can be queried when forming the DOM. The state must be mutated through callbacks provided to React, called <em>effects</em>.</p>
<p>Let’s start with a single Piece which needs no effects at all. Its state will be held by its parent components instead. The so called “lifting up” of state like this is a common practice in React applications which allows components to be reused. The piece can either be empty or contain a kana (Japanese character).</p>
<p>Since Pieces will always be stored in ordered groups, we provide the array and index of the piece, rather than the value itself. This will let us mutate the value when handling drag and drop.</p>
<p>When a piece is dragged over another, the two should swap. To handle this we create a closure for the source and destination which replaces the current value with a given one, and returns the previous one. The key here is that even though the drag and drop events might happen in different groupings, the closure will store enough state that a swap can still be performed. We also use a callback to notify the parent that a change has been made so that the state can be mutated to reflect this.</p>
<div class="annotated-code">
<p><span><em>«client.jsx»=</em></span></p>
<div class="sourceCode" id="cb1" data-file="client.jsx"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Piece</span>({ dragDomain<span class="op">,</span> flags<span class="op">,</span> draggable<span class="op">,</span> index<span class="op">,</span> els<span class="op">,</span> children<span class="op">,</span> onDrop }) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> drag <span class="op">=</span> e <span class="kw">=&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">window</span><span class="op">.</span><span class="at">dragged</span> <span class="op">=</span> (val) <span class="kw">=&gt;</span> { <span class="kw">let</span> temp <span class="op">=</span> els[index]<span class="op">;</span> els[index] <span class="op">=</span> val<span class="op">;</span> <span class="cf">return</span> temp }</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> drop <span class="op">=</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        e<span class="op">.</span><span class="fu">preventDefault</span>()</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> dropped <span class="op">=</span> (val) <span class="kw">=&gt;</span> { <span class="kw">let</span> temp <span class="op">=</span> els[index]<span class="op">;</span> els[index] <span class="op">=</span> val<span class="op">;</span> <span class="cf">return</span> temp }</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">dropped</span>(<span class="bu">window</span><span class="op">.</span><span class="fu">dragged</span>(<span class="fu">dropped</span>()))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        onDrop <span class="op">&amp;&amp;</span> <span class="fu">onDrop</span>()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> style <span class="op">=</span> <span class="st">&#39;piece&#39;</span> <span class="op">+</span> ((flags <span class="op">&amp;</span> <span class="dv">1</span>)<span class="op">?</span> <span class="st">&#39; hilight&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                          <span class="op">+</span> ((flags <span class="op">&amp;</span> <span class="dv">2</span>)<span class="op">?</span> <span class="st">&#39; pulse&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span> <span class="ot">className</span><span class="op">=</span><span class="va">{</span>style<span class="va">}</span> <span class="ot">data-key</span><span class="op">=</span><span class="va">{</span>index<span class="va">}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>             <span class="ot">onDragStart</span><span class="op">=</span><span class="va">{</span>e <span class="kw">=&gt;</span> <span class="fu">drag</span>(e)<span class="va">}</span> <span class="ot">onDrop</span><span class="op">=</span><span class="va">{</span>e <span class="kw">=&gt;</span> <span class="fu">drop</span>(e)<span class="va">}</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>             <span class="ot">onDragOver</span><span class="op">=</span><span class="va">{</span>e <span class="kw">=&gt;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="va">}</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>             <span class="ot">draggable</span><span class="op">=</span><span class="va">{</span>draggable<span class="va">}</span><span class="kw">&gt;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">{</span>els[index]<span class="va">}</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/div&gt;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>A nice thing about using a literate style of programming here is that we can group the relevant CSS class for our <code>Piece</code> with the component itself, which is the best of both worlds in the debate over inline vs. separate style.</p>
<div class="annotated-code">
<p><span><em>«client.css»=</em></span></p>
<div class="sourceCode" id="cb2" data-file="client.css"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.piece</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span>: <span class="dv">inline-block</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span>: <span class="dv">2</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">width</span>: <span class="dv">80</span><span class="dt">px</span><span class="op">;</span> <span class="kw">height</span>: <span class="dv">80</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">vertical-align</span>: <span class="dv">top</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">line-height</span>: <span class="dv">80</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">cursor</span>: <span class="dv">pointer</span><span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background-color</span>: <span class="cn">#eee</span><span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>Another really cool thing is that we can embed a test right here to see what it will look like by abusing the fact that our documentation uses HTML just like our compiled client will. If we embed <code>&lt;Piece els={['ね']} index={0} /&gt;</code> in the documentation we will get:</p>
<div id="example-38">

</div>
<script type='text/babel'>
ReactDOM.render(
    <Piece els={['ね']} index={0} />,
    document.getElementById('example-38')
)
</script>
<p>A piece in isolation is not so interesting: we need to be able to deal with them in groups of rows and columns. The player should be able to drag a piece from their rack to the board, so this implies that the state should be held at a higher level like with the piece, <em>but</em> we will need to receive drag messages, so we handle those here and call a callback provided to us by our parent component.</p>
<div class="annotated-code">
<p><span><em>«client.jsx»+</em></span></p>
<div class="sourceCode" id="cb3" data-file="client.jsx"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Grid</span>({ onDrop<span class="op">,</span> flags<span class="op">,</span> rows<span class="op">,</span> cols<span class="op">,</span> els }) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div&gt;</span><span class="va">{</span><span class="bu">Array</span>(rows)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">map</span>((_<span class="op">,</span> j) <span class="kw">=&gt;</span> (</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div&gt;</span><span class="va">{</span><span class="bu">Array</span>(cols)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">map</span>((_<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> k <span class="op">=</span> j<span class="op">*</span>cols<span class="op">+</span>i</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">&lt;Piece</span> <span class="ot">draggable</span><span class="op">=</span><span class="va">{</span><span class="kw">true</span><span class="va">}</span> <span class="ot">key</span><span class="op">=</span><span class="va">{</span>k<span class="va">}</span> <span class="ot">els</span><span class="op">=</span><span class="va">{</span>els<span class="va">}</span> <span class="ot">index</span><span class="op">=</span><span class="va">{</span>k<span class="va">}</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                       <span class="ot">onDrop</span><span class="op">=</span><span class="va">{</span>onDrop<span class="va">}</span> <span class="ot">flags</span><span class="op">=</span><span class="va">{</span>flags <span class="op">&amp;&amp;</span> flags[k]<span class="va">}</span> <span class="fu">/&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        })<span class="va">}</span><span class="kw">&lt;/div&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        ))<span class="va">}</span><span class="kw">&lt;/div&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>Again let’s test to make sure everything is working. We’ll just use an alert to handle the drag events for now since we don’t have anywhere to store state yet.</p>
<div id="example-61">

</div>
<script type='text/babel'>
const arr = [null,null,null, null,'ね',null, null,null,null]
ReactDOM.render(
    <Grid rows={3} cols={3} els={arr} onDrop={() => alert('onDrop called')} />,
    document.getElementById('example-61')
)
</script>
<p>We have all the main components, it is time to implement the actual game. We’ll make use of dependency inversion by passing a connection object to our component which abstracts away the detail of talking to the server. This will also allow us to switch out with a single player version for testing. We’ll also assume that the game we are provided has been created and joined.</p>
<div class="annotated-code">
<p><span><em>«client.jsx»+</em></span></p>
<div class="sourceCode" id="cb4" data-file="client.jsx"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Scrapple</span>({ connection }) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [game<span class="op">,</span> setGame] <span class="op">=</span> React<span class="op">.</span><span class="fu">useState</span>(<span class="kw">null</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> merge <span class="op">=</span> (newGame) <span class="kw">=&gt;</span> {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        newGame<span class="op">.</span><span class="at">prev</span> <span class="op">=</span> game<span class="op">?</span> game<span class="op">.</span><span class="at">board</span> <span class="op">:</span> []</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        newGame <span class="op">=</span> { <span class="op">...</span>game<span class="op">,</span> <span class="op">...</span>newGame }</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setGame</span>(newGame)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> submit <span class="op">=</span> () <span class="kw">=&gt;</span> connection<span class="op">.</span><span class="fu">set</span>(game)<span class="op">.</span><span class="fu">then</span>(merge)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> update <span class="op">=</span> () <span class="kw">=&gt;</span> connection<span class="op">.</span><span class="fu">get</span>()<span class="op">.</span><span class="fu">then</span>(merge)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">useInterval</span>(update<span class="op">,</span> game <span class="op">&amp;&amp;</span> game<span class="op">.</span><span class="at">player</span><span class="op">.</span><span class="at">isTurn</span><span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> <span class="dv">3000</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>game)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return </span><span class="kw">&lt;p&gt;</span>Loading...<span class="kw">&lt;/p&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> board <span class="op">=</span> { <span class="op">...</span>game<span class="op">.</span><span class="at">board</span> }</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rack <span class="op">=</span> { <span class="op">...</span>game<span class="op">.</span><span class="at">player</span><span class="op">.</span><span class="at">rack</span> }</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> drop <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> newGame <span class="op">=</span> { <span class="op">...</span>game }</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        newGame<span class="op">.</span><span class="at">board</span> <span class="op">=</span> board</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        newGame<span class="op">.</span><span class="at">player</span><span class="op">.</span><span class="at">rack</span> <span class="op">=</span> rack</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setGame</span>(newGame)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> flags <span class="op">=</span> <span class="bu">Array</span>(game<span class="op">.</span><span class="at">width</span> <span class="op">*</span> game<span class="op">.</span><span class="at">width</span>)<span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>apply<span class="op">-</span>turn<span class="op">&gt;&gt;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>hilight<span class="op">&gt;&gt;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div&gt;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">&lt;Grid</span> <span class="ot">rows</span><span class="op">=</span><span class="va">{</span>game<span class="op">.</span><span class="at">width</span><span class="va">}</span> <span class="ot">cols</span><span class="op">=</span><span class="va">{</span>game<span class="op">.</span><span class="at">width</span><span class="va">}</span> <span class="ot">onDrop</span><span class="op">=</span><span class="va">{</span>drop<span class="va">}</span> <span class="ot">els</span><span class="op">=</span><span class="va">{</span>board<span class="va">}</span> <span class="ot">flags</span><span class="op">=</span><span class="va">{</span>flags<span class="va">}</span> <span class="fu">/&gt;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">&lt;Grid</span> <span class="ot">rows</span><span class="op">=</span><span class="va">{</span><span class="dv">1</span><span class="va">}</span> <span class="ot">cols</span><span class="op">=</span><span class="va">{</span><span class="dv">7</span><span class="va">}</span> <span class="ot">onDrop</span><span class="op">=</span><span class="va">{</span>drop<span class="va">}</span> <span class="ot">els</span><span class="op">=</span><span class="va">{</span>rack<span class="va">}</span> <span class="fu">/&gt;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;input</span> <span class="ot">type</span><span class="op">=</span><span class="st">&#39;button&#39;</span> <span class="ot">disabled</span><span class="op">=</span><span class="va">{</span><span class="op">!</span>game<span class="op">.</span><span class="at">player</span><span class="op">.</span><span class="at">isTurn</span><span class="va">}</span> <span class="ot">onClick</span><span class="op">=</span><span class="va">{</span>submit<span class="va">}</span> <span class="kw">/&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/div&gt;</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>The <code>useInterval</code> hook is taken from <a href="https://overreacted.io/making-setinterval-declarative-with-react-hooks/">this article</a>. It allows us to update the game on a variable time interval, which lets us stop polling when it’s the player’s turn, and resume when it is not.</p>
<div class="annotated-code">
<p><span><em>«client.jsx»+</em></span></p>
<div class="sourceCode" id="cb5" data-file="client.jsx"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">useInterval</span>(callback<span class="op">,</span> delay) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> savedCallback <span class="op">=</span> React<span class="op">.</span><span class="fu">useRef</span>()<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remember the latest callback.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    React<span class="op">.</span><span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        savedCallback<span class="op">.</span><span class="at">current</span> <span class="op">=</span> callback<span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> [callback])<span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set up the interval.</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    React<span class="op">.</span><span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">function</span> <span class="fu">tick</span>() {</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            savedCallback<span class="op">.</span><span class="fu">current</span>()<span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (delay <span class="op">!==</span> <span class="kw">null</span>) {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> id <span class="op">=</span> <span class="pp">setInterval</span>(tick<span class="op">,</span> delay)<span class="op">;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> () <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(id)<span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> [delay])<span class="op">;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="annotated-code">
<p><span><em>«client.css»+</em></span></p>
<div class="sourceCode" id="cb6" data-file="client.css"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.hilight</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">opacity</span>: <span class="dv">0.5</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="annotated-code">
<p><span><em>«hilight»=</em></span></p>
<div class="sourceCode" id="hilight"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="hilight-1"><a href="#hilight-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> queue <span class="op">=</span> [<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(flags<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span>)]</span>
<span id="hilight-2"><a href="#hilight-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (queue<span class="op">.</span><span class="at">length</span>) {</span>
<span id="hilight-3"><a href="#hilight-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> top <span class="op">=</span> queue<span class="op">.</span><span class="fu">pop</span>()</span>
<span id="hilight-4"><a href="#hilight-4" aria-hidden="true" tabindex="-1"></a>    flags[top] <span class="op">|=</span> <span class="dv">1</span></span>
<span id="hilight-5"><a href="#hilight-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (board[top] <span class="op">||</span> game<span class="op">.</span><span class="at">prev</span>[top])</span>
<span id="hilight-6"><a href="#hilight-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">let</span> k <span class="kw">of</span> [top<span class="op">+</span>game<span class="op">.</span><span class="at">width</span><span class="op">,</span> top<span class="op">-</span>game<span class="op">.</span><span class="at">width</span><span class="op">,</span> top<span class="op">+</span><span class="dv">1</span><span class="op">,</span> top<span class="dv">-1</span>])</span>
<span id="hilight-7"><a href="#hilight-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (k <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> k <span class="op">&lt;</span> flags<span class="op">.</span><span class="at">length</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>(flags[k] <span class="op">&amp;</span> <span class="dv">1</span>))</span>
<span id="hilight-8"><a href="#hilight-8" aria-hidden="true" tabindex="-1"></a>                queue<span class="op">.</span><span class="fu">push</span>(k)</span>
<span id="hilight-9"><a href="#hilight-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="annotated-code">
<p><span><em>«client.css»+</em></span></p>
<div class="sourceCode" id="cb7" data-file="client.css"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.pulse</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">animation-name</span>: pulse<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">animation-duration</span>: <span class="dv">0.25</span><span class="dt">s</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">animation-timing-function</span>: <span class="dv">ease-in-out</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">@keyframes</span> pulse {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">from</span>, <span class="dv">to</span> {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">background-color</span>: <span class="cn">#eee</span><span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">50%</span> {</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">background-color</span>: <span class="cn">#fbb</span><span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="annotated-code">
<p><span><em>«apply-turn»=</em></span></p>
<div class="sourceCode" id="apply-turn"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="apply-turn-1"><a href="#apply-turn-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">let</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> game<span class="op">.</span><span class="at">width</span> <span class="op">*</span> game<span class="op">.</span><span class="at">width</span><span class="op">;</span> k<span class="op">++</span>)</span>
<span id="apply-turn-2"><a href="#apply-turn-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (board[k] <span class="op">!=</span> game<span class="op">.</span><span class="at">prev</span>[k])</span>
<span id="apply-turn-3"><a href="#apply-turn-3" aria-hidden="true" tabindex="-1"></a>        flags[k] <span class="op">|=</span> <span class="dv">2</span></span></code></pre></div>
</div>
<p>Now to test the game so far let’s create a simple test connection.</p>
<div class="annotated-code">
<p><span><em>«client.jsx»+</em></span></p>
<div class="sourceCode" id="cb8" data-file="client.jsx"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">SingleplayerConnection</span>() {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">game</span> <span class="op">=</span> {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">width</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">board</span><span class="op">:</span> <span class="bu">Array</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">5</span>)<span class="op">.</span><span class="fu">fill</span>(<span class="kw">null</span>)<span class="op">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">player</span><span class="op">:</span> {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">isTurn</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">rack</span><span class="op">:</span> [<span class="st">&#39;a&#39;</span><span class="op">,</span><span class="st">&#39;b&#39;</span><span class="op">,</span><span class="st">&#39;c&#39;</span><span class="op">,</span><span class="st">&#39;d&#39;</span><span class="op">,</span><span class="st">&#39;e&#39;</span><span class="op">,</span><span class="st">&#39;f&#39;</span><span class="op">,</span><span class="st">&#39;g&#39;</span>]<span class="op">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>SingleplayerConnection<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">get</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((res<span class="op">,</span> err) <span class="kw">=&gt;</span> <span class="fu">res</span>(<span class="kw">this</span><span class="op">.</span><span class="at">game</span>))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>SingleplayerConnection<span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">set</span> <span class="op">=</span> <span class="kw">function</span>(newGame) {</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((res<span class="op">,</span> err) <span class="kw">=&gt;</span> {</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">game</span> <span class="op">=</span> newGame</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">player</span><span class="op">.</span><span class="at">isTurn</span> <span class="op">=</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">player</span><span class="op">.</span><span class="at">isTurn</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">player</span><span class="op">.</span><span class="at">isTurn</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                <span class="kw">const</span> k <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">*</span> <span class="kw">this</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">width</span> <span class="op">*</span> <span class="kw">this</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">width</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                <span class="kw">const</span> board <span class="op">=</span> {<span class="op">...</span><span class="kw">this</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">board</span>}</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                board[k] <span class="op">=</span> <span class="st">&#39;A&#39;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">this</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">board</span> <span class="op">=</span> board</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                <span class="kw">this</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">player</span><span class="op">.</span><span class="at">isTurn</span> <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span> <span class="dv">5000</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">res</span>(<span class="kw">this</span><span class="op">.</span><span class="at">game</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="example-128">

</div>
<script type='text/babel'>
ReactDOM.render(
    <Scrapple connection={new SingleplayerConnection()}></Scrapple>,
    document.getElementById('example-128')
)
</script>
<p>We glossed over exactly how we communicate with the server, but now this will serve as our transition from talking about the client to server. We will use GraphQL as our communication protocol, so let’s begin by looking at the schema we will be using.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> GetGame <span class="op">=</span> <span class="vs">`{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="vs">    game(id: $gameID) {</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="vs">        status</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="vs">        width</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="vs">        board</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="vs">        player(id: $playerID) {</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="vs">            isTurn</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="vs">            score</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="vs">            rack</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        moves {</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="vs">            position</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="vs">            horizontal</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="vs">            length</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="vs">            score</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="vs">}`</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> UpdateGame <span class="op">=</span> <span class="vs">`{</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="vs">}`</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> SetGame <span class="op">=</span> <span class="vs">`{</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="vs">}`</span></span></code></pre></div>
<pre class="gql"><code>type Player {
    id: ID!
    isTurn: Boolean
    score: Number
    order: Number
    rack: [String]
}
type Game {
    id: ID!
    status: String
    width: Number
    board: [String]
    players: [Player]
    turns: [Turn]
}
type Move {
    position: Number
    horizontal: Boolean
    length: Number
    score: Number
}
type Turn {
    game: Game
    player: Player
    order: Number
    moves: [Move]
}
type Subscription {
    turnTaken(gameID: ID!, playerID: ID!): Turn
}</code></pre>
</body>
</html>
